kind: pipeline
type: docker
name: default

steps:
  # - name: lint
  #   image: node:20
  #   commands:
  #     - npm ci
  #     - npm run lint
  - name: deploy
    image: appleboy/drone-ssh

    settings:
      host: 147.45.246.176
      username: root
      password: ch4A#3UJ7y*4A*
      port: 22
      script:
        - cd /root/papyan
        - source ~/.nvm/nvm.sh
        - nvm use 22
        - git pull origin main
        - npm ci
        - npm run build
        - pm2 restart front

  - name: notify
    image: appleboy/drone-telegram:1.3.10
    settings:
      token:
        from_secret: telegram_token
      to: 800465831
      message: |
        ‚úÖ –£—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ –Ω–∞ –≤–µ—Ç–∫–µ main!
        üìù –ö–æ–º–º–∏—Ç: ${DRONE_COMMIT_MESSAGE}
        üë§ –ê–≤—Ç–æ—Ä: ${DRONE_COMMIT_AUTHOR}
        üîó [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è](https://github.com/–≤–∞—à-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π/commit/${DRONE_COMMIT_SHA})

trigger:
  event:
    - push
    - promote
    - custom
# trigger:
#   branch:
#     - master
#   event:
#     - push

